#! /bin/bash

echo "测试所有的端口是否通"

ips="172.31.6.100
172.31.6.101
172.31.6.102
172.31.6.103
172.31.6.104
172.31.6.105
172.31.6.106
172.31.6.107
172.31.6.108
172.31.6.109
172.31.6.111
172.31.6.112
172.31.6.113
172.31.6.114
172.31.6.115
172.31.6.116
172.31.6.117
172.31.6.118
172.31.6.119
172.31.6.120
172.31.6.121
172.31.6.122
172.31.6.123
172.31.6.124
172.31.6.125
172.31.6.126
172.31.6.127
172.31.6.128
172.31.6.129
172.31.6.130
172.31.6.131
172.31.6.132
172.31.6.133
172.31.6.134
172.31.6.135
172.31.6.137
172.31.6.139
172.31.6.140
172.31.6.141
172.31.6.142
172.31.6.143
172.31.6.145
172.31.6.146
172.31.6.147
172.31.6.148
172.31.6.149
172.31.6.150
172.31.6.151
172.31.6.152
172.31.6.153
172.31.6.154
172.31.6.155
172.31.6.156
172.31.6.157
172.31.6.158
172.31.6.159
172.31.6.160
172.31.6.161
172.31.6.162
172.31.6.163
172.31.6.164
172.31.6.165
172.31.6.166
172.31.6.167
172.31.6.168
172.31.6.169
172.31.6.170
172.31.6.171
172.31.6.172
172.31.6.173
172.31.6.174
172.31.6.175
172.31.6.176
172.31.6.177
172.31.6.178
172.31.6.21
172.31.6.22
172.31.6.24
172.31.6.245
172.31.6.25
172.31.6.26
172.31.6.27
172.31.6.29
172.31.6.30
172.31.6.31
172.31.6.32
172.31.6.33
172.31.6.34
172.31.6.35
172.31.6.36
172.31.6.37
172.31.6.38
172.31.6.39
172.31.6.40
172.31.6.41
172.31.6.42
172.31.6.43
172.31.6.44
172.31.6.45
172.31.6.46
172.31.6.47
172.31.6.48
172.31.6.49
172.31.6.50
172.31.6.51
172.31.6.52
172.31.6.53
172.31.6.54
172.31.6.55
172.31.6.56
172.31.6.57
172.31.6.58
172.31.6.59
172.31.6.70
172.31.6.71
172.31.6.72
172.31.6.73
172.31.6.74
172.31.6.75
172.31.6.76
172.31.6.77
172.31.6.79
172.31.6.80
172.31.6.81
172.31.6.82
172.31.6.83
172.31.6.84
172.31.6.85
172.31.6.86
172.31.6.87
172.31.6.88
172.31.6.89
172.31.6.91
172.31.6.92
172.31.6.93
172.31.6.94
172.31.6.94
172.31.6.95
172.31.6.96
172.31.6.97
172.31.6.98"

index=0
testPort() {
	
	echo -e "\n$index 测试 $1:$2"
	index=`expr $index + 1`
	#RESULT=`echo "" | telnet $1 $2 2> /dev/null`
	RESULT=`echo quit | timeout --signal=9 2 telnet $1 $2`
	# RESULT string includes "Escape"
	if [[ $RESULT =~ "Escape" ]]; then
    	echo -e "host $1's tcp port $2 is \033[31mopening\033[0m."
    	echo -e "host $1's tcp port $2 is \033[31mopening\033[0m." >> result.txt
	else
    	# Defect: time consuming
    	echo -e "host $1's tcp port $2 is \033[31mclosed\033[0m."
    	echo -e "host $1's tcp port $2 is \033[31mclosed\033[0m." >> result.txt
	fi
}


for ip in $ips
do
	testPort $ip 23
done








